<div class="panel-container" (click)="$event.stopPropagation()" role="dialog" aria-labelledby="panel-title" aria-modal="true">
  <!-- Panel Header -->
  <div class="panel-header">
    <div class="header-content">
      <h3 id="panel-title" class="panel-title">Work Order Details</h3>
      <p class="panel-subtitle">Specify the dates, name and status for this order</p>
    </div>
    <div class="header-actions">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="onCancel()"
        [disabled]="isSubmitting()"
        aria-label="Cancel changes"
      >
        Cancel
      </button>
      <button 
        type="submit" 
        class="btn btn-primary" 
        (click)="onSubmit()"
        [disabled]="isSubmitting()"
        [attr.aria-label]="submitButtonText + ' work order'"
      >
        @if (isSubmitting()) {
          <span class="spinner" aria-hidden="true"></span>
        }
        {{ submitButtonText }}
      </button>
    </div>
  </div>

  <!-- Panel Body -->
  <div class="panel-body">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Work Order Name -->
      <div class="form-group">
        <label class="form-label" for="name">Work Order Name</label>
        <input
          type="text"
          id="name"
          class="form-input"
          formControlName="name"
          placeholder="Acme Inc."
          [class.error]="hasError('name')"
          [attr.aria-invalid]="hasError('name')"
          aria-required="true"
        />
        @if (hasError('name')) {
          <span class="error-message" role="alert">Work order name is required</span>
        }
      </div>

      <!-- Status -->
      <div class="form-group">
        <label class="form-label" for="status">Status</label>
        <ng-select
          id="status"
          class="status-select"
          formControlName="status"
          [items]="statusOptions"
          bindLabel="label"
          bindValue="value"
          [clearable]="false"
          [searchable]="false"
          appendTo="body"
          labelForId="status"
          aria-label="Select status"
        >
          <ng-template ng-label-tmp let-item="item">
            <span class="status-option" [ngClass]="'status-' + item.value.toLowerCase().replace(' ', '-')">
              {{ item.label }}
            </span>
          </ng-template>
          <ng-template ng-option-tmp let-item="item">
            <span class="status-option" [ngClass]="'status-' + item.value.toLowerCase().replace(' ', '-')">
              {{ item.label }}
            </span>
          </ng-template>
        </ng-select>
      </div>

      <!-- End Date -->
      <div class="form-group">
        <label class="form-label" for="endDate">End date</label>
        <div class="date-input-wrapper">
          <input
            type="text"
            id="endDate"
            class="form-input date-input"
            placeholder="01.01.2026"
            ngbDatepicker
            #endPicker="ngbDatepicker"
            formControlName="endDate"
            (click)="endPicker.toggle()"
            readonly
            [container]="'body'"
            [class.error]="hasError('endDate')"
            [attr.aria-invalid]="hasError('endDate')"
            aria-required="true"
            aria-label="Select end date"
          />
        </div>
        @if (hasError('endDate')) {
          <span class="error-message" role="alert">End date is required</span>
        }
      </div>

      <!-- Start Date -->
      <div class="form-group">
        <label class="form-label" for="startDate">Start date</label>
        <div class="date-input-wrapper">
          <input
            type="text"
            id="startDate"
            class="form-input date-input"
            placeholder="02.01.2026"
            ngbDatepicker
            #startPicker="ngbDatepicker"
            formControlName="startDate"
            (click)="startPicker.toggle()"
            readonly
            [container]="'body'"
            [class.error]="hasError('startDate')"
            [attr.aria-invalid]="hasError('startDate')"
            aria-required="true"
            aria-label="Select start date"
          />
        </div>
        @if (hasError('startDate')) {
          <span class="error-message" role="alert">Start date is required</span>
        }
      </div>

      <!-- Work Center (Hidden in design but keeping for functionality) -->
      <input type="hidden" formControlName="workCenterId" />

      <!-- Overlap Error -->
      @if (overlapError()) {
        <div class="overlap-error" role="alert">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M8 5.333V8M8 10.667h.007M14.667 8A6.667 6.667 0 111.333 8a6.667 6.667 0 0113.334 0z" stroke="#E74C3C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>{{ overlapError() }}</span>
        </div>
      }
    </form>
  </div>
</div>
